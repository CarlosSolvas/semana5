---
import BaseLayout from '../layouts/BaseLayout.astro';

// 1) Leemos todos los .md de src/content/posts
const modules = import.meta.glob('../content/posts/*.md', { eager: true });

// 2) Transformamos a array de posts
type Post = { slug: string; title: string; date: string };
const posts: Post[] = Object.entries(modules).map(([path, mod]) => {
  const fileName = path.split('/').pop()!;       // "primer-post.md"
  const slug = fileName.replace(/\.md$/, '');    // "primer-post"
  const { title, date } = (mod as any).frontmatter || {};
  return { slug, title, date };
})
// 3) Filtramos los que no tienen frontmatter completo
.filter((p) => p.title && p.date)
// 4) Opcional: ordenamos por fecha (más reciente primero)
.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
---

<BaseLayout title="Blog">
  <h1>Blog</h1>

  {posts.length === 0 ? (
    <p>No hay posts todavía.</p>
  ) : (
    <ul>
      {posts.map((post) => (
        <li>
          <a href={`/semana5/blog/${post.slug}`}>{post.title}</a> —{' '}
          <time datetime={post.date}>{post.date}</time>
        </li>
      ))}
    </ul>
  )}
</BaseLayout>
